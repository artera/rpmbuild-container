#!/bin/bash -e

NAME=$1

if [ -z "$NAME" ]; then
    echo "Usage: $0 PACKAGE_NAME"
    exit 1
fi

if [ -z "$YUM_CACHE_DIR" -o ! -d "$YUM_CACHE_DIR" ]; then
    YUM_CACHE_DIR='/var/cache/yum/$basearch/$releasever'
fi

sed -r "s/^cachedir=.*/cachedir=${YUM_CACHE_DIR}/" -i /etc/yum.conf

cd "$HOME/rpmbuild/package"

mkdir -p target
rm -f target/$NAME-*.src.rpm

spectool -g -R $NAME.spec
rpmbuild -bs --nodeps $NAME.spec
yum-builddep -y $NAME.spec
rpmbuild --rebuild target/$NAME-*.src.rpm
